<!DOCTYPE HTML>
<html>
<head>
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta http-equiv="Content-Security-Policy" content="upgrade-insecure-requests" />
    <meta charset="utf-8">
    <title>直播</title>
    <!--<script type="text/javascript" src="assets/js/clappr.min.js"></script>-->
    <script src="//cdn.bootcss.com/clappr/0.3.9/clappr.min.js"></script>
    <!--<script type="text/javascript" src="assets/js/TcPlayer-2.3.2.js" charset="utf-8"></script>-->
    <script type="text/javascript" src="//imgcache.qq.com/open/qcloud/video/vcplayer/TcPlayer-2.3.2.js" charset="utf-8"></script>

</head>

<body>

    <button onclick="location.reload()">刷新</button>
    <button onclick="intiVideoObj(VideoType.tc_player)" id="btn_tcplayer">备用播放1</button>
    <button onclick="intiVideoObj(VideoType.c_player)" id="btn_clapprplayer">备用播放2</button>
    <h3>
        部分浏览器需要<a style="color:red;text-decoration:underline">手动点击播放按钮</a>才能进行播放<br />
        如果不能播放请点击上方<a style="color:red;text-decoration:underline">备用播放</a>按钮<br />
    </h3>
    <div id="div_mobile_h5player" style="display:none">
        <!--<h1>H5Player</h1>-->
        <video referrerpolicy="origin" src="" id="H5Player" controls autoplay="autoplay" style="border:1px solid #000" width="100%">
            <!--<source src="http://live.gklsoft.com/live/test.m3u8">-->
            浏览器不支持 video 标签。
        </video>
    </div>

    <div id="div_pc_tcplayer" style="display:none">
        <!--<h1>TcPlayer</h1>-->
        <div id="tc_player"></div>
    </div>

    <br />
    <br />

    <div id="div_pc_clapprplayer" style="display:none;margin:0;padding:0">
        <!--<h1>ClapprPlayer</h1>-->
        <div id="clappr_player"></div>
    </div>
    本次宣告1-7<br />
    1、我是属耶稣基督的人，蒙召成为神的圣徒，我的生命是信而顺服的生命。1:5-7<br />
    2、福音的大能拯救了我，在我里面运行，我是活在福音的大能中，因为我因信得着了神的义。1:16-17<br />
    3、我是真犹太人，在灵里受了真割礼，我有从神来的称赞。2:29<br />
    4、我是效法亚伯拉罕信心的人，是他的后裔，承受世界的应许是归给我的。4:16<br />
    5、我信的神是叫死人复活、使无变有的神；是赦免我一切罪孽，医治我一切疾病的神。4:17<br />
    6、我在没有指望的时候，因着信，就有指望，任何无望的情形都会发生翻转。4:18<br />
    7、我的信心不软弱不动摇，没有疑惑，因为我不看环境，不考虑身体的感觉。我只仰望神的应许，不断感恩和赞美，满心信服神的应许必能成就。4:19-20<br />
    <script>

        /**
          * m3u8接流地址
          */
        var m3u8 = "http://live.gklsoft.com/live/test.m3u8";
        /**
        * flv接流地址
        */
        var flv = "http://live.gklsoft.com/live/test.flv";

        /**
          * 判断客户类型
          */
        function IsPC() {
            var userAgentInfo = navigator.userAgent;
            var Agents = ["Android", "iPhone", "SymbianOS", "Windows Phone", "iPad", "iPod"];
            var flag = true;
            for (var v = 0; v < Agents.length; v++) {
                if (userAgentInfo.indexOf(Agents[v]) > 0) {
                    flag = false;
                    break;
                }
            }
            return flag;
        }

        //var flag = IsPC(); //true为PC端，false为手机端

        /**
          * 腾讯播放器
          */
        var tc_player = null;//

        /**
          * Clappr播放器
          */
        var c_player = null;//

        /**
          * H5播放器
          */
        var h5_video = null;


        /**
          * 视屏类型
          */
        var VideoType = {
            //腾讯video
            tc_player: 0,
            //ClapprVideo
            c_player: 1,
            //H5Video
            h5_video: 2,
        }

        /**
          * 初始化视屏
          * @param {VideoType}whatVideoType 初始化视屏类型
          */
        function intiVideoObj(whatVideoType) {
            var div_mobile_h5player = document.getElementById('div_mobile_h5player')//手机端播放器层
            var div_pc_clapprplayer = document.getElementById('div_pc_clapprplayer');//Clappr播放器层
            var div_pc_tcplayer = document.getElementById('div_pc_tcplayer');//腾讯播放器层
            var btn_tcplayer = document.getElementById('btn_tcplayer');//腾讯播放器按钮
            var btn_clapprplayer = document.getElementById('btn_clapprplayer');//Clappr播放器按钮

            switch (whatVideoType) {

                case VideoType.c_player:
                    div_pc_clapprplayer.style.display = "";
                    btn_tcplayer.style.display = "";

                    div_pc_tcplayer.style.display = "none";
                    div_mobile_h5player.style.display = "none";
                    btn_clapprplayer.style.display = "none";

                    if (c_player == null) {
                        c_player = new Clappr.Player(
                            {
                                source: m3u8,
                                parentId: "#clappr_player",
                            });
                    }

                    if (h5_video != null) {
                        h5_video.pause();//H5暂停
                    }

                    if (tc_player != null) {
                        tc_player.pause();//腾讯暂停
                    }

                    c_player.play();//Clappr播放
                    break;

                case VideoType.tc_player:
                    div_pc_tcplayer.style.display = "";
                    btn_clapprplayer.style.display = "";

                    div_mobile_h5player.style.display = "none";
                    div_pc_clapprplayer.style.display = "none";
                    btn_tcplayer.style.display = "none";

                    if (tc_player == null) {
                        tc_player = new TcPlayer('tc_player',
                            {
                                m3u8: m3u8,
                                flv: flv,
                                autoplay: true,//iOS 下 safari 浏览器，以及大部分移动端浏览器是不开放视频自动播放这个能力的
                                width: '480',//视频的显示宽度，请尽量使用视频分辨率宽度
                                height: '320',//视频的显示高度，请尽量使用视频分辨率高度
                                volume: 1,//音量 0-1
                                listener: function (msg) {
                                    // console.log('listener',msg);
                                    if (msg.type == 'error') {
                                        window.setTimeout(function () {
                                            tc_player.load();//进行重连
                                        }, 1000);
                                    }
                                }
                            });//腾讯播放器
                    }

                    if (h5_video != null) {
                        h5_video.pause();//H5暂停
                    }

                    if (c_player != null) {
                        c_player.pause();//Clappr暂停
                    }

                    tc_player.play();//腾讯播放
                    break;

                case VideoType.h5_video:

                    div_mobile_h5player.style.display = "";
                    btn_clapprplayer.style.display = "";
                    btn_tcplayer.style.display = "";

                    div_pc_clapprplayer.style.display = "none";
                    btn_tcplayer.style.display = "none";


                    if (h5_video == null) {
                        h5_video = document.querySelector("#H5Player");//H5播放器
                        h5_video.setAttribute("src", m3u8);
                        h5_video.onended = function () {
                            window.setTimeout(function () {
                                h5_video.setAttribute("src", m3u8);
                                h5_video.play();//H5播放
                            }, 1000);
                        };

                        h5_video.onerror = function () {
                            window.setTimeout(function () {
                                h5_video.setAttribute("src", m3u8);
                                h5_video.play();//H5播放
                            }, 1000);
                        };

                        h5_video.onoffline = function () {
                            window.setTimeout(function () {
                                h5_video.setAttribute("src", m3u8);
                                h5_video.play();//H5播放
                            }, 1000);
                        };
                        h5_video.onoffline = function () {
                            window.setTimeout(function () {
                                h5_video.setAttribute("src", m3u8);
                                h5_video.play();//H5播放
                            }, 1000);
                        };
                    }

                    if (c_player != null) {
                        c_player.pause();//Clappr暂停
                    }

                    if (tc_player != null) {
                        tc_player.pause();//腾讯暂停
                    }

                    h5_video.play();//H5播放
                    break;
                default:
                    break;
            }
        }


        if (IsPC()) {
            intiVideoObj(VideoType.tc_player);
        } else {
            intiVideoObj(VideoType.h5_video);
        }
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                //}
    </script>
</body>
</html>

